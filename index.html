<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Orçamentos | ColorGlass</title>
<meta name="description" content="Lista de orçamentos de portas de vidro e alumínio em Fortaleza.">

<style>
body { margin:0; font-family:Arial, Helvetica, sans-serif; background:#f2f2f2; }
.app { display:grid; grid-template-columns:18% 82%; height:100vh; }
.sidebar { background:#1e1e1e; color:white; padding:20px; display:flex; flex-direction:column; gap:10px; }
.sidebar button { padding:10px; border:none; background:#333; color:white; border-radius:6px; cursor:pointer; }
.content { padding:25px; overflow-y:auto; height:100vh; }
table { border-collapse: collapse; width:100%; margin-top:10px; }
th, td { border:1px solid #ccc; padding:5px; text-align:left; }
th { background:#ddd; }
.btn { padding:5px 10px; border:none; border-radius:5px; cursor:pointer; background:#0078d7; color:white; }
</style>
</head>
<body>
<div class="app">
    <div class="sidebar">
        <h3>ColorGlass</h3>
        <button onclick="go('portas.html')">Orçamentos</button>
        <button onclick="go('perfis.html')">Perfis</button>
        <button onclick="go('vidros.html')">Vidros</button>
        <button onclick="go('producao.html')">Produção</button>
        <button onclick="go('insumos.html')">Insumos</button>
        <button onclick="go('catalogo.html')">Catálogo</button>
        <button onclick="go('ajustes.html')">Ajustes</button>
    </div>

    <div class="content">
        <h1>Orçamentos Existentes</h1>
        <div id="orcamentosExistentes"><em>Carregando...</em></div>
    </div>
</div>

<script>
function go(p){ window.location.href = p; }

// =====================
// CONFIGURAÇÃO SUPABASE
// =====================
const SUPABASE_URL = "https://<SEU_PROJECT_ID>.supabase.co";
const SUPABASE_KEY = "<SUA_SUPABASE_KEY>";

async function carregarOrcamentos() {
    try {
        const res = await fetch(`${SUPABASE_URL}/rest/v1/orcamentos?select=*`, {
            headers: {
                "apikey": SUPABASE_KEY,
                "Authorization": "Bearer " + SUPABASE_KEY
            }
        });
        const orcamentos = await res.json();
        const container = document.getElementById("orcamentosExistentes");
        container.innerHTML = "";

        if(orcamentos.length === 0){
            container.innerHTML = "<em>Nenhum orçamento encontrado.</em>";
            return;
        }

        const table = document.createElement("table");
        table.innerHTML = `
            <thead>
                <tr>
                    <th># Pedido</th>
                    <th>Cliente</th>
                    <th>Data Criação</th>
                    <th>Qtd Total</th>
                    <th>Valor Total (R$)</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody></tbody>
        `;
        const tbody = table.querySelector("tbody");

        orcamentos.forEach(o => {
            const tr = document.createElement("tr");
            const dataCriacao = o.data_criacao ? new Date(o.data_criacao).toLocaleString() : "";
            tr.innerHTML = `
                <td>${o.numero_pedido || ""}</td>
                <td>${o.cliente_nome || ""}</td>
                <td>${dataCriacao}</td>
                <td>${o.quantidade_total || 0}</td>
                <td>${(o.valor_total || 0).toFixed(2)}</td>
                <td><button class="btn" onclick="editarOrcamento('${o.id}')">Editar</button></td>
            `;
            tbody.appendChild(tr);
        });

        container.appendChild(table);
    } catch(err){
        console.error("Erro ao carregar orçamentos:", err);
        document.getElementById("orcamentosExistentes").innerHTML = "<em>Erro ao carregar orçamentos.</em>";
    }
}

function editarOrcamento(uuid){
    window.location.href = `/portas.html?orcamento_uuid=${encodeURIComponent(uuid)}`;
}

// =====================
// CARREGA TUDO AO INICIAR
// =====================
carregarOrcamentos();
</script>
</body>
</html>


