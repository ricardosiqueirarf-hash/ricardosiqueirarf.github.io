<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Corte de Vidro - ColorGlass</title>
<style>
body { font-family: Arial, sans-serif; background: #f2f2f2; margin: 0; padding: 0; }
.container { max-width: 1200px; margin: auto; padding: 20px; }
h1 { text-align:center; }
label { display:block; margin:10px 0 5px; }
input, select { padding:5px; width:150px; margin-right:10px; }
button { padding: 6px 12px; margin-top:10px; cursor:pointer; }
table { border-collapse: collapse; width:100%; margin-top:15px; }
th, td { border:1px solid #ccc; padding:5px; text-align:center; }
th { background:#ddd; }
#svgChapa { border:1px solid #333; background:#fff; margin-top:20px; width: 600px; height: 800px; }
</style>
</head>
<body>
<div class="container">
    <h1>Simulador de Corte de Vidro</h1>

    <div id="formPeca">
        <label>Largura (mm)<input type="number" id="largura" value="500"></label>
        <label>Altura (mm)<input type="number" id="altura" value="600"></label>
        <label>Espessura (mm)<input type="number" id="espessura" value="8"></label>
        <label>Tipo de Vidro
            <select id="tipoVidro">
                <option value="comum">Comum</option>
                <option value="temperado">Temperado</option>
                <option value="laminado">Laminado</option>
            </select>
        </label>
        <label>Perda (%)<input type="number" id="perda" value="5"></label>
        <label>Quantidade<input type="number" id="quantidade" value="1"></label>
        <button onclick="adicionarPeca()">Adicionar Peça</button>
    </div>

    <h2>Peças Adicionadas</h2>
    <table id="tabelaPecas">
        <thead>
            <tr>
                <th>#</th>
                <th>Largura</th>
                <th>Altura</th>
                <th>Espessura</th>
                <th>Tipo</th>
                <th>Perda</th>
                <th>Qtd</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <button onclick="calcularCorte()">Calcular Corte</button>

    <h2>Distribuição na Chapa (SVG)</h2>
    <svg id="svgChapa"></svg>

    <h2>Resultado</h2>
    <pre id="resultado"></pre>
</div>

<script>
const PEÇAS = [];
const CHAPA_LARGURA = 2400;
const CHAPA_ALTURA = 3210;

function adicionarPeca() {
    const largura = +document.getElementById("largura").value;
    const altura = +document.getElementById("altura").value;
    const espessura = +document.getElementById("espessura").value;
    const tipoVidro = document.getElementById("tipoVidro").value;
    const perda = +document.getElementById("perda").value;
    const quantidade = +document.getElementById("quantidade").value;

    PEÇAS.push({ largura, altura, espessura, tipoVidro, perda, quantidade });
    renderTabela();
}

function renderTabela() {
    const tbody = document.querySelector("#tabelaPecas tbody");
    tbody.innerHTML = "";
    PEÇAS.forEach((p, i) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${i+1}</td>
            <td>${p.largura}</td>
            <td>${p.altura}</td>
            <td>${p.espessura}</td>
            <td>${p.tipoVidro}</td>
            <td>${p.perda}</td>
            <td>${p.quantidade}</td>
            <td><button onclick="removerPeca(${i})">Remover</button></td>
        `;
        tbody.appendChild(tr);
    });
}

function removerPeca(idx) {
    PEÇAS.splice(idx,1);
    renderTabela();
}

async function calcularCorte() {
    if(PEÇAS.length === 0) return alert("Adicione pelo menos uma peça.");

    try {
        const res = await fetch("https://colorglass.onrender.com/api/cortevidro", {
            method:"POST",
            headers: {'Content-Type':'application/json'},
            body: JSON.stringify({pecas: PEÇAS})
        });
        const data = await res.json();
        if(!data.success) throw new Error(data.error || "Erro ao calcular corte");

        document.getElementById("resultado").textContent = JSON.stringify(data, null, 2);
        desenharSVG(data.distribuicao || []);
    } catch(e) {
        console.error(e);
        alert("Erro ao calcular corte: "+e.message);
    }
}

function desenharSVG(distribuicao) {
    const svg = document.getElementById("svgChapa");
    svg.innerHTML = "";
    const scaleX = svg.clientWidth / CHAPA_LARGURA;
    const scaleY = svg.clientHeight / CHAPA_ALTURA;

    distribucao.forEach(p => {
        const rect = document.createElementNS("http://www.w3.org/2000/svg","rect");
        rect.setAttribute("x", p.x * scaleX);
        rect.setAttribute("y", p.y * scaleY);
        rect.setAttribute("width", p.largura * scaleX);
        rect.setAttribute("height", p.altura * scaleY);
        rect.setAttribute("fill", "#99ccff");
        rect.setAttribute("stroke","#000");
        rect.setAttribute("stroke-width",1);
        svg.appendChild(rect);
    });
}
</script>
</body>
</html>

