<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cadastro | ColorGlass</title>
<meta name="description" content="Cadastro de usuários ColorGlass.">

<style>
:root {
    --cg-blue: #1079ba;
    --cg-blue-dark: #0d5d8c;
    --cg-blue-soft: #e7f3fb;
    --cg-gold: #f0c24c;
    --cg-white: #ffffff;
    --cg-text: #1f2933;
}

* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
}

body {
    background:
        radial-gradient(circle at top, rgba(16,121,186,0.15), transparent 55%),
        linear-gradient(135deg, #f5fbff 0%, #eef4f9 45%, #f8fbff 100%);
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 32px 20px;
    color: var(--cg-text);
}

.page {
    width: min(1100px, 100%);
    display: flex;
    flex-direction: column;
    gap: 24px;
}

/* ✅ AJUSTE: limita largura do topo (logo + título) sem fixar */
.brand {
    display: flex;
    gap: 16px;
    padding: 20px 24px;
    background: var(--cg-white);
    border-radius: 18px;
    box-shadow: 0 10px 30px rgba(15,44,62,0.12);

    max-width: 780px;
    width: 100%;
    margin: 0 auto;
}

.logo-mark {
    width: 52px;
    height: 52px;
    border-radius: 14px;
    box-shadow: 0 8px 18px rgba(16,121,186,0.35);
    overflow: hidden;
}

.logo-mark img {
    width: 100%;
    height: 100%;
    object-fit: contain;
}

.container {
    display: grid;
    grid-template-columns: 1fr;

    /* ✅ AJUSTE: limita largura do bloco do cadastro sem fixar */
    max-width: 680px; /* um pouco maior que login pq tem mais campos */
    width: 100%;
    margin: 0 auto;
}

.card {
    background: var(--cg-white);
    padding: 28px;
    border-radius: 18px;
    box-shadow: 0 12px 30px rgba(15,44,62,0.12);
}

.card h2 {
    color: var(--cg-blue);
    margin-bottom: 16px;
}

label {
    display: flex;
    flex-direction: column;
    gap: 6px;
    margin-bottom: 12px;
    font-size: 0.95rem;
}

input {
    padding: 12px 14px;
    border-radius: 10px;
    border: 1px solid #d4d9df;
    font-size: 0.95rem;
}

input:focus {
    outline: none;
    border-color: var(--cg-blue);
    box-shadow: 0 0 0 3px rgba(16,121,186,0.15);
}

.row-2 {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
}

@media (max-width: 520px) {
    .row-2 { grid-template-columns: 1fr; }
}

.btn {
    margin-top: 10px;
    width: 100%;
    padding: 12px;
    border-radius: 12px;
    border: none;
    background: linear-gradient(135deg, var(--cg-blue), var(--cg-blue-dark));
    color: #fff;
    font-weight: 600;
    cursor: pointer;
}

.btn:disabled {
    opacity: 0.55;
    cursor: not-allowed;
}

.status {
    margin-top: 12px;
    min-height: 20px;
    font-size: 0.9rem;
}

.status.ok { color: #0c7c3c; }
.status.erro { color: #c23616; }

.hint {
    margin-top: 10px;
    font-size: 0.85rem;
    color: #6b7280;
}
</style>
</head>

<body>
<div class="page">

    <header class="brand">
        <div class="logo-mark">
            <img src="https://hfhwvzldhgqniqnurync.supabase.co/storage/v1/object/public/teste/logo.jpg" alt="Logo ColorGlass">
        </div>
        <div>
            <h1>ColorGlass</h1>
            <p>Cadastro de parceiros</p>
        </div>
    </header>

    <div class="container">
        <div class="card">
            <h2>Cadastro</h2>

            <!-- DADOS DO CLIENTE -->
            <label>Nome completo
                <input id="nome" type="text">
            </label>

            <div class="row-2">
                <label>CPF / CNPJ
                    <input id="cpf_cnpj" type="text">
                </label>

                <label>CEP
                    <input id="cep" type="text">
                </label>
            </div>

            <label>Endereço
                <input id="endereco" type="text">
            </label>

            <div class="row-2">
                <label>WhatsApp / Celular
                    <input id="whatsapp" type="text">
                </label>

                <label>Email
                    <input id="email" type="email">
                </label>
            </div>

            <!-- CREDENCIAIS -->
            <label>Usuário
                <input id="user" type="text">
            </label>

            <label>Senha
                <input id="pass" type="password">
            </label>

            <button class="btn" id="btnCadastrar" onclick="cadastrar()" disabled>
                Cadastrar
            </button>

            <div id="status" class="status"></div>

            <p class="hint">
                Após o cadastro, aguarde a aprovação do administrador.
            </p>
        </div>
    </div>
</div>

<script>
const API_BASE = "https://colorglass.onrender.com";

const campos = [
    "nome","cpf_cnpj","cep","endereco",
    "whatsapp","email","user","pass"
];

function getData() {
    const d = {};
    campos.forEach(id => d[id] = document.getElementById(id).value.trim());
    return d;
}

function validarTudo() {
    const d = getData();
    return campos.every(k => d[k]);
}

function setStatus(msg, tipo="") {
    const el = document.getElementById("status");
    el.textContent = msg;
    el.className = "status " + tipo;
}

function updateBtn() {
    document.getElementById("btnCadastrar").disabled = !validarTudo();
}

campos.forEach(id => {
    document.getElementById(id).addEventListener("input", updateBtn);
});

async function post(url, body) {
    const r = await fetch(url, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
    });
    return r.json();
}

async function cadastrar() {
    if (!validarTudo()) return;

    const d = getData();
    setStatus("Cadastrando usuário...");

    // 1) cria usuário
    const rUser = await post(`${API_BASE}/api/usuarios/cadastro`, {
        user: d.user,
        pass: d.pass
    });

    if (!rUser.success) {
        setStatus(rUser.error || "Erro ao criar usuário", "erro");
        return;
    }

    // 2) cria cliente
    setStatus("Salvando dados do cliente...");
    const rCliente = await post(`${API_BASE}/api/clientes/cadastro`, {
        nome: d.nome,
        dados: {
            cpf_cnpj: d.cpf_cnpj,
            endereco: d.endereco,
            cep: d.cep,
            whatsapp: d.whatsapp,
            email: d.email
        }
    });

    if (!rCliente.success) {
        setStatus(
            "Usuário criado, mas erro ao salvar cliente. Avise o admin.",
            "erro"
        );
        return;
    }

    setStatus("Cadastro realizado com sucesso!", "ok");
    campos.forEach(id => document.getElementById(id).value = "");
    updateBtn();
}
</script>
</body>
</html>

